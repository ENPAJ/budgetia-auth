{% extends "base.html" %}
{% block content %}
<div class="card p-3">
  <h5>Scanner un ticket (OCR)</h5>
  <form id="scanForm" method="post" enctype="multipart/form-data">
    <div class="mb-2"><input required name="ticket" type="file" accept="image/*" class="form-control"></div>
    <button class="btn btn-primary">Scanner</button>
  </form>
  <div id="result" class="mt-3"></div>
</div>

<script>
document.getElementById('scanForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const fd = new FormData(e.target);
  const res = await fetch(location.href, { method: 'POST', body: fd });
  const j = await res.json();
  const out = document.getElementById('result');
  if (!j.ok) out.innerHTML = `<div class="alert alert-danger">${j.error || 'Erreur'}</div>`;
  else out.innerHTML = `<pre style="white-space:pre-wrap">${j.text}</pre>`;
});
</script>
{% endblock %}
